<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Downloader Pro</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#0d6efd" />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%230d6efd'/%3E%3Ctext x='50' y='50' font-size='50' fill='white' text-anchor='middle' dy='.1em' font-family='sans-serif' font-weight='bold'%3ED%3C/text%3E%3C/svg%3E"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .container {
        max-width: 600px;
      }
      #preview-area {
        display: none;
      }
      #preview-area.show {
        display: block;
      }
      #thumbnail {
        width: 120px;
        height: 90px;
        object-fit: cover;
        border-radius: 0.375rem;
      }
    </style>
  </head>
  <body class="d-flex align-items-center py-4">
    <main class="w-100 m-auto">
      <div class="container">
        <div class="card shadow-sm">
          <div class="card-body p-4 p-md-5">
            <h1 class="card-title text-center h3 mb-4 fw-bold text-primary">
              Downloader Pro
            </h1>
            <div class="mb-3">
              <select id="platform" class="form-select form-select-lg">
                <option value="youtube">YouTube</option>
                <option value="tiktok">TikTok</option>
                <option value="facebook">Facebook</option>
              </select>
            </div>
            <div class="input-group input-group-lg mb-3">
              <input
                type="text"
                id="urlInput"
                class="form-control"
                placeholder="Tempel URL Video di sini"
              />
              <button
                id="cekVideoBtn"
                onclick="getVideoInfo()"
                class="btn btn-primary"
                type="button"
              >
                Cek Video
              </button>
            </div>
            <div id="status-area" class="mt-4 text-center"></div>
            <div id="preview-area" class="mt-4">
              <div class="card bg-light p-3">
                <div class="d-flex align-items-center">
                  <img id="thumbnail" src="" alt="Thumbnail" class="me-3" />
                  <div class="flex-grow-1">
                    <h5 id="title" class="mb-2" style="font-size: 1rem"></h5>
                    <button
                      id="downloadBtn"
                      class="btn btn-success btn-sm w-100"
                    >
                      Unduh Video (MP4)
                    </button>
                    <button
                      id="downloadMp3Btn"
                      class="btn btn-info btn-sm w-100 mt-2"
                    >
                      Unduh Audio (MP3)
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("/service-worker.js");
        });
      }
      const urlInput = document.getElementById("urlInput");
      const statusArea = document.getElementById("status-area");
      const previewArea = document.getElementById("preview-area");
      const downloadBtn = document.getElementById("downloadBtn");
      const downloadMp3Btn = document.getElementById("downloadMp3Btn");
      const cekVideoBtn = document.getElementById("cekVideoBtn");
      let currentVideoInfo = {};
      async function getVideoInfo() {
        const url = urlInput.value;
        if (!url) {
          statusArea.innerHTML = `<p class="text-danger fw-semibold">Silakan masukkan URL!</p>`;
          return;
        }
        cekVideoBtn.disabled = true;
        cekVideoBtn.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Mengecek...`;
        previewArea.classList.remove("show");
        statusArea.innerHTML = "";
        try {
          const res = await fetch("/info", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url }),
          });
          const data = await res.json();
          if (res.ok) {
            currentVideoInfo = data;
            displayPreview(data);
          } else {
            statusArea.innerHTML = `<p class="text-danger fw-semibold">❌ ${
              data.error || "Gagal."
            }</p>`;
          }
        } catch (err) {
          statusArea.innerHTML = `<p class="text-danger fw-semibold">❌ Kesalahan jaringan.</p>`;
        } finally {
          cekVideoBtn.disabled = false;
          cekVideoBtn.innerHTML = "Cek Video";
        }
      }
      function displayPreview(data) {
        document.getElementById("thumbnail").src = data.thumbnail;
        document.getElementById("title").innerText = data.title;
        const encodedUrl = encodeURIComponent(data.originalUrl);
        downloadBtn.onclick = () => {
          window.location.href = `/unduh?url=${encodedUrl}`;
        };
        downloadMp3Btn.onclick = () => {
          window.location.href = `/unduh-audio?url=${encodedUrl}`;
        };
        previewArea.classList.add("show");
      }
    </script>
  </body>
</html>
